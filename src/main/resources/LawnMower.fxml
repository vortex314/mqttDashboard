<?xml version="1.0" encoding="UTF-8"?>

<?language javascript?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import org.controlsfx.control.ToggleSwitch?>

<?import java.lang.String?>
<?import java.lang.Boolean?>
<?import javafx.beans.property.BooleanProperty?>
<?import javafx.beans.property.SimpleBooleanProperty?>
<?import be.limero.dashboard.Mqtt?>
<?import javafx.scene.control.TextField?>
<AnchorPane fx:id="anchorPane" prefHeight="400.0" prefWidth="600.0"
            xmlns="http://javafx.com/javafx/8.0.999-ea"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="be.limero.dashboard.Controller">
    <fx:script>
        var mqtt=controller.mqtt

        function publish(topic,msg) {
        controller.publish(topic,JSON.stringify(msg));
        }

        function log(o) {
        print("LOG >> "+JSON.stringify(o));
        }

        function setControlText(control,value) {
        control.text=value
        }

        function setControlDisable(control,value) {
        control.disabled=value
        }


    </fx:script>
    <fx:define>
        <Boolean fx:id="on" fx:value="false"/>
    </fx:define>
    <fx:script>
    </fx:script>
    <children>
        <VBox fx:id="vbox" layoutY="-2.0" prefHeight="400.0" prefWidth="592.0">
            <children>
                <HBox prefHeight="15.0" prefWidth="592.0">
                    <children>
                        <ToggleSwitch fx:id="mqttSwitch" prefHeight="73.0" prefWidth="93.0" text="MQTT"
                                      textAlignment="CENTER" selected="true"
                                      onMouseClicked="if (mqttSwitch.selected) { mqtt.connect() } else mqtt.disconnect()">
                        </ToggleSwitch>
                        <ToggleSwitch fx:id="powerSwitch" prefHeight="73.0" prefWidth="93.0" text="Power"
                                      textAlignment="CENTER"
                                      onMouseClicked="publish('dst/pi3/gpio21/value',powerSwitch.selected?1:0)"/>
                        <Label alignment="CENTER" prefHeight="27.0" prefWidth="58.0" text="Motor"/>
                        <Button fx:id="motorStartButton"
                                onAction="publish('dst/drive/motor/state','START')"
                                style="-fx-graphic: url('start.png')"/>
                        <Button fx:id="motorStopButton"
                                onAction="publish('dst/drive/motor/state','STOP')"
                                style="-fx-graphic: url('stop.png')"/>
                        <Button fx:id="motorPauseButton"
                                onAction="publish('dst/drive/motor/state','PAUSE')"
                                style="-fx-graphic: url('pause.png')"/>
                        <Label fx:id="motorMessage" prefHeight="27.0" prefWidth="315.0" text="motor message.."/>
                        <Label fx:id="espCounter" prefHeight="27.0" prefWidth="315.0" text="esp82 counter"/>

                    </children>
                    <padding>
                        <Insets right="8.0"/>
                    </padding>
                </HBox>
            </children>
            <fx:script>
                controller.subscribeExpired('src/ESP82-10027/system/alive',powerSwitch,setControlDisable);
                controller.subscribe('src/ESP82-10027/system/alive',motorMessage,setControlText)
                controller.subscribe('src/ESP82-10027/system/counter',espCounter,setControlText)

            </fx:script>
        </VBox>
    </children>
</AnchorPane>
